<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Hierarchical secret derivation with Blake2b and random number generators."><meta name="keywords" content="rust, rustlang, rust-lang, secret_tree"><title>secret_tree - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings"></script><script src="../storage.js"></script><script src="../crates.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../favicon.svg">
<link rel="alternate icon" type="image/png" href="../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../secret_tree/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><p class="location">Crate secret_tree</p><div class="block version"><p>Version 0.4.0</p></div><div class="sidebar-elems"><a id="all-types" href="all.html"><p>See all secret_tree's items</p></a><div class="block items"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li><li><a href="#traits">Traits</a></li><li><a href="#types">Type Definitions</a></li></ul></div><p class="location"></p><div id="sidebar-vars" data-name="secret_tree" data-ty="mod" data-relpath="../"></div><script defer src="../sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu"><img src="../brush.svg" width="18" height="18" alt="Pick another theme!"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" class="help-button">?</button>
                <a id="settings-menu" href="../settings.html"><img src="../wheel.svg" width="18" height="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="">secret_tree</a><button id="copy-path" onclick="copy_path(this)">⎘</button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/secret_tree/lib.rs.html#1-576" title="goto source code">[src]</a></span></h1><div class="docblock"><p>Hierarchical secret derivation with Blake2b and random number generators.</p>
<h1 id="how-it-works" class="section-header"><a href="#how-it-works">How it works</a></h1>
<p>This crate provides <a href="struct.SecretTree.html" title="SecretTree"><code>SecretTree</code></a> – a structure produced from a 32-byte seed that
may be converted into a secret key or a cryptographically secure
pseudo-random number generator (CSPRNG).
Besides that, an <code>SecretTree</code> can produce child trees, which are
identified by a string <a href="struct.Name.html" title="Name"><code>Name</code></a> or an integer index. This enables creating
<em>hierarchies</em> of secrets (like <code>some_secret/0</code>, <code>some_secret/1</code> and <code>other_secret/foo/1/bar</code>),
which are ultimately derived from a single <code>SecretTree</code>. It’s enough to securely store
the seed of this root tree (e.g., in a passphrase-encrypted form) to recreate all secrets.</p>
<p>The derived secrets cannot be linked; leakage of a derived secret does not compromise
sibling secrets or the parent <code>SecretTree</code>.</p>
<h1 id="crate-features" class="section-header"><a href="#crate-features">Crate features</a></h1>
<p>The crate is <code>no_std</code>-compatible. There is optional <code>std</code> support enabled via the <code>std</code> feature,
which is on by default.</p>
<h1 id="implementation-details" class="section-header"><a href="#implementation-details">Implementation details</a></h1>
<p><code>SecretTree</code> uses the <a href="https://tools.ietf.org/html/rfc7693">Blake2b</a> keyed hash function to derive the following kinds of data:</p>
<ul>
<li>secret key</li>
<li>CSPRNG seed (the RNG used is <a href="https://rust-random.github.io/rand/rand_chacha/type.ChaChaRng.html" title="ChaChaRng"><code>ChaChaRng</code></a>)</li>
<li>seeds for child <code>SecretTree</code>s</li>
</ul>
<p>The procedure is similar to the use of Blake2b for key derivation in <a href="https://download.libsodium.org/doc/key_derivation">libsodium</a>:</p>
<ul>
<li>Blake2b is used with a custom initialization block. The block has two
customizable parameters of interest: <em>salt</em> and <em>personalization</em> (each is 16 bytes).
See the table below for information how these two parameters are set for each type
of derived data.</li>
<li>The key is the seed of the <code>SecretTree</code> instance used for derivation.</li>
<li>The message is an empty bit string.</li>
</ul>
<p>The length of derived data is 32 bytes in all cases.</p>
<h2 id="salt-and-personalization" class="section-header"><a href="#salt-and-personalization">Salt and personalization</a></h2><table><thead><tr><th align="left">Data type</th><th align="left">Salt</th><th align="left">Personalization</th></tr></thead><tbody>
<tr><td align="left">Secret key</td><td align="left"><code>[0; 16]</code></td><td align="left"><code>b&quot;bytes\0\0...\0&quot;</code></td></tr>
<tr><td align="left">CSPRNG seed</td><td align="left"><code>[0; 16]</code></td><td align="left"><code>b&quot;rng\0\0...\0&quot;</code></td></tr>
<tr><td align="left">Seed for a named child</td><td align="left"><code>name.as_bytes()</code> (zero-padded)</td><td align="left"><code>b&quot;name\0\0...\0&quot;</code></td></tr>
<tr><td align="left">Seed for an indexed child</td><td align="left"><code>LittleEndian(index)</code></td><td align="left"><code>b&quot;index\0\0...\0&quot;</code></td></tr>
</tbody></table>
<p>Derivation of a secret key, CSPRNG seed and seeds for indexed children are
all fully compatible with libsodium.
libsodium uses the salt section in the Blake2b initialization block to store
the <em>index</em> of a child key, and the personalization section to store its <em>context</em>.</p>
<p>For example, the CSPRNG seed can be computed as follows (if we translate libsodium API
from C to Rust):</p>

<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">rand::SeedableRng</span>;
<span class="kw">use</span> <span class="ident">rand_chacha::ChaChaRng</span>;

<span class="kw">let</span> <span class="ident">parent_seed</span>: [<span class="ident">u8</span>; <span class="number">32</span>] <span class="op">=</span> <span class="comment">// ...</span>
<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">rng_seed</span> <span class="op">=</span> [<span class="number">0</span>; <span class="number">32</span>];
<span class="ident">crypto_kdf_derive_from_key</span>(
    <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">rng_seed</span>,
    <span class="comment">/* index */</span> <span class="number">0</span>,
    <span class="comment">/* context */</span> <span class="string">b&quot;rng\0\0\0\0\0&quot;</span>,
    <span class="comment">/* master_key */</span> <span class="kw-2">&amp;</span><span class="ident">parent_seed</span>,
);
<span class="kw">let</span> <span class="ident">rng</span> <span class="op">=</span> <span class="ident">ChaChaRng::from_seed</span>(<span class="ident">rng_seed</span>);</pre></div>
<p>In case of named children, we utilize the entire salt section, while libsodium
only uses the first 8 bytes.</p>
<h1 id="design-motivations" class="section-header"><a href="#design-motivations">Design motivations</a></h1>
<ul>
<li>We allow to derive RNGs besides keys in order to allow a richer variety of applications.
RNGs can be used in more complex use cases than fixed-size byte arrays,
e.g., when the length of the secret depends on previous RNG output, or RNG is used to sample
a complex distribution.</li>
<li>Derivation in general (instead of using a single <code>SeedableRng</code> to create all secrets)
allows to add new secrets or remove old ones without worrying about compatibility.</li>
<li>Child RNGs identified by an index can be used to derive secrets of the same type,
the quantity of which is unbounded. As an example, they can be used to produce
blinding factors for <a href="https://en.wikipedia.org/wiki/Commitment_scheme">Pedersen commitments</a> (e.g., in a privacy-focused cryptocurrency).</li>
<li>Some steps are taken to make it difficult to use <code>SecretTree</code> incorrectly. For example,
<code>rng()</code> and <code>fill()</code> methods consume the tree instance, which makes it harder to reuse
the same RNG for multiple purposes (which is not intended).</li>
</ul>
</div><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<table><tr class="module-item"><td><a class="struct" href="struct.Name.html" title="secret_tree::Name struct">Name</a></td><td class="docblock-short"><p>Name of a child <a href="struct.SecretTree.html" title="SecretTree"><code>SecretTree</code></a>.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.SecretTree.html" title="secret_tree::SecretTree struct">SecretTree</a></td><td class="docblock-short"><p>Seeded structure that can be used to produce secrets and child <code>SecretTree</code>s.</p>
</td></tr></table><h2 id="enums" class="section-header"><a href="#enums">Enums</a></h2>
<table><tr class="module-item"><td><a class="enum" href="enum.NameError.html" title="secret_tree::NameError enum">NameError</a></td><td class="docblock-short"><p>Errors that can occur when converting a <code>&amp;str</code> into <a href="struct.Name.html" title="Name"><code>Name</code></a>.</p>
</td></tr></table><h2 id="constants" class="section-header"><a href="#constants">Constants</a></h2>
<table><tr class="module-item"><td><a class="constant" href="constant.MAX_NAME_LEN.html" title="secret_tree::MAX_NAME_LEN constant">MAX_NAME_LEN</a></td><td class="docblock-short"><p>Maximum byte length of a <a href="struct.Name.html" title="Name"><code>Name</code></a> (16).</p>
</td></tr><tr class="module-item"><td><a class="constant" href="constant.SEED_LEN.html" title="secret_tree::SEED_LEN constant">SEED_LEN</a></td><td class="docblock-short"><p>Byte length of a <a href="type.Seed.html"><code>Seed</code></a> (32).</p>
</td></tr></table><h2 id="traits" class="section-header"><a href="#traits">Traits</a></h2>
<table><tr class="module-item"><td><a class="trait" href="trait.AsByteSliceMut.html" title="secret_tree::AsByteSliceMut trait">AsByteSliceMut</a></td><td class="docblock-short"><p>Converts a type to a mutable byte slice. This is used within the crate to fill
secret values with the RNG output.</p>
</td></tr></table><h2 id="types" class="section-header"><a href="#types">Type Definitions</a></h2>
<table><tr class="module-item"><td><a class="type" href="type.Seed.html" title="secret_tree::Seed type">Seed</a></td><td class="docblock-short"><p>Alias for a <a href="https://docs.rs/secrecy/0.8.0/secrecy/struct.Secret.html" title="Secret"><code>Secret</code></a> array that contains seed bytes.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../" data-current-crate="secret_tree" data-search-index-js="../search-index.js" data-search-js="../search.js"></div>
    <script src="../main.js"></script></body></html>